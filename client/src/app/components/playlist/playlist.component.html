<app-navbar></app-navbar>
<app-loading *ngIf="!playlist"></app-loading>
<div class="outer-container" *ngIf="playlist">
    <div class="upper-container">
        <a routerLink="/sort" class="nav-link">
            <img src="assets/svg/back.svg" alt="Back"> 
        </a>
        <img class="playlist-cover" *ngIf="playlist.images" [src]="playlist.images[0]?.url" alt="Playlist Cover">
        <img class="playlist-cover" *ngIf="!playlist.images" src="assets/svg/note.svg" alt="Playlist Cover">
        <div class="playlist-details">
            <p class="playlist-tracks"*ngIf="playlist.public">Public Playlist</p>
            <p class="playlist-tracks"*ngIf="!playlist.public">Private Playlist</p>
            <p class="playlist-name">{{ playlist.name }}</p>
            <p class="playlist-tracks"> {{ playlist.owner['display_name'] }} &bull; {{ playlist.tracks['total'] }} songs </p>
        </div>
    </div>
    <ul class="tracks-container" *ngIf="playlist.songs">
        <li class="track" *ngFor="let song of playlist.songs" [ngClass]="{'open-dropdown': song.more}">  
            <img class="track-cover" *ngIf="song.album && song.album.images && song.album.images.length > 0"
                [src]="song.album.images[0].url" alt="Track cover">
            <div class="track-details">
                <p class="track-title"> {{ song.name > 30 ? song.name.slice(0, 30) + '...' : song.name}} </p>
                <p class="track-artist"> {{ song.artists[0]['name']}} </p>
            </div>
            <p class="compatibility-text">Compatibility with playlist: </p>
            <div class="compatibility-bar">
                <div class="compatibility-filled" [style.width.%]="song.current_compatibility"></div>
                <span class="compatibility-percentage">{{ song.current_compatibility }}%</span>
                <button type="button" (click)="removeFromPlaylist(song)">Remove</button>
            </div>
            <div class="view-more">
                <img *ngIf="!song.more" src="assets/svg/more.svg" alt="More" (click)="toggleDropdown(song)"> 
            </div>
            <div class="dropdown" [ngClass]="{'open': song.more}">
                <p> This song is best suited to playlist: {{ song.best_fit.name }}</p>
                <p> {{ song.max_compatibility }}%</p>
                <button type="button" (click)="changeTrackPlaylist(song)">Add to playlist</button>
                <img class="view-less" src="assets/svg/less.svg" alt="Less" (click)="toggleDropdown(song)">
                <div>
                    
                </div>
            </div>
        </li>
    </ul> 
</div>
